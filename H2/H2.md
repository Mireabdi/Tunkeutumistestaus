## Palvelinten Hallinta
## ICI001AS3A-3010
### Abdirahman Mire

# H2 Lisää vain vesi

## Työympäristö

Käyttöjärjestelmä: Windows 11 Home 64-bit

Suoritin: Intel Core i3-1215U

Muisti: 8GB DDR4

Näytönohjain: Intel UHD Graphics (Samsung)

Virtuaalinen kone: VMware:n kautta asennettu Kali Linux


## X)€ Jaswal 2020: Mastering Metasploit - 4ed: Chapter 1

- Penetraatiotestauksen vaiheet ja virtuaaliympäristö.

- Metasploitin peruskomennot ja moduulit (exploit, post-exploit, auxiliary).

- Testiharjoitus kohteeseen ja Domain Controlleriin.

## A) Osoita testein, että koneet eivät saa yhteyttä Internetiin ja Koneet saavat yhteyden toisiinsa.

![kuva1](/H2/kuvat/kuva1.png)
![kuva1](/H2/kuvat/kuva2.png)

KaliVM offline tilassa ja metasploitable2 saa host only yhteyden.

## B&C) Metasploitable käyttöön.

`msfconsole` komennolla:

![kuva1](/H2/kuvat/kuva5.png)

Selaimella metasploitable palvelimen tarkistus:

![kuva1](/H2/kuvat/kuva4.png)

## D&E) Porttiskannaus & tietojen tarkastelu.

Porttiskannaus komennoilla: `db_nmap -A -p- 192.168.42.128` `nmap -A -p- -oA fullscan 192.168.42.128`

Hosts:

![kuva1](/H2/kuvat/kuva6.png)

Services:

![kuva1](/H2/kuvat/kuva7.png)

Suodattamiseen käytin komentoa `services -p 21`

![kuva1](/H2/kuvat/kuva8.png)

## F) Vertailu  tallennuksista:

`nmap -oA`: Tallentaa kolme tiedostoa (normaali, XML, grepable). Hyödyllinen, jos haluaa jakaa tulokset tai käyttää muissa työkaluissa.
`db_nmap`: Tallentaa suoraan Metasploitin tietokantaan. Tiedot heti käytettävissä Metasploitin komennoilla (hosts, services, suodatus).

## G) Murtaudu vsftpd:hen.

 Yritin ensin `use 0` mutta tuli vastaus target not vulnerable. Huomasin myös laittaneeni väärän RHOST, varmaan vaikutti tulokseen.
 
![kuva1](/H2/kuvat/kuva9.png)


Seuraavaksi käytin `use 1`, tämä toimi ja sain shellin:

![kuva1](/H2/kuvat/kuva10.png)

## H) Sessio meterpreteriin.

Päivitin shellin Meterpreter-sessioon komennolla sessions -u 2.
Metasploit avasi uuden Meterpreter-session komennolla sessions -i 3


![kuva1](/H2/kuvat/kuva11.png)

## I) Lateral movement.

Hain levittäytymiseen tarvittavaa tietoa komennoilla:

`getuid`: näyttää käyttäjäoikeudet: tässä sessiossa oli root-oikeudet, jotka mahdollistavat lateral movementin muihin järjestelmän osiin.

`sysinfo`: näyttää käyttöjärjestelmän ja järjestelmän tiedot, joiden perusteella voidaan valita sopivat hyökkäysmoduulit.

![kuva1](/H2/kuvat/kuva12.png)

## J) Toinen hyökkäys: Telnet.

Aloitin msfconsolessa komennolla `search telnet`, tämä listasi kaikki telnet exploitit. Valitsin *auxiliary/scanner/telnet/telnet_login*

Ensimmäinen yritys admin/admin epäonnistui, väärä tunnus.

![kuva1](/H2/kuvat/kuva13.png)

Testasin Metasploitable 2:n oletustiliä: msfadmin/msfadmin, kirjautuminen onnistui. Shell session avautui.

Komennolla `sessions -u 1`: sessio meterpreteriin.

![kuva1](/H2/kuvat/kuva14.png)

![kuva1](/H2/kuvat/kuva15.png)


## K) Meterpreterin ominaisuuksia: 

`sysinfo`: Kertoi koneen perustiedot.

![kuva1](/H2/kuvat/kuva16.png)

`cat /etc/passwd`: Näytti käyttäjätilitiedot kohdekoneelta.

![kuva1](/H2/kuvat/kuva17.png)

## L) Session tallennus.

Käynnistin shellin Metasploitableen `sessions -i 1`

ajoin `script -fa log001.txt`

![kuva1](/H2/kuvat/kuva18.png)



### Referenssit
Karvinen: https://terokarvinen.com/tunkeutumistestaus/#h2-lisaa-vain-vesi
https://learning.oreilly.com/library/view/mastering-metasploit/9781838980078/B15076_01_Final_ASB_ePub.xhtml#_idParaDest-46



